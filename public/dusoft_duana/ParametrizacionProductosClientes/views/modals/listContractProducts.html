<div class="modal-header">
    <button type="button" class="close" style="opacity: 0.5;" ng-click="cerrar()">&times;</button>
    <h4 class="modal-title" style="color: #1c59b5;">Actualización del contrato</h4>
</div>
<div class="modal-body">
    <div class="panel panel-primary">
        <div class="panel-heading" style="text-transform: uppercase; text-align: center; margin: 0px; font-weight: 700;">
            Información del Contrato
        </div>
        <div class="panel-body">
            <div class="col-sm-12 container-factura-info">
                <div class="col-sm-12">
                    <span>Contrato: <label class="ng-binding">#{{root.data.currentContract.contrato_numero}}</label></span>
                    <span>Tercero: <label class="ng-binding">{{root.data.currentContract.nombre_tercero || 'Sin Tercero'}}</label></span>
                    <span>Usuario: <label class="ng-binding">{{usuarioName}}</label></span>
                </div>
                <div class="col-sm-12">
                    <span>Fecha Inicio: <label class="ng-binding">{{root.data.currentContract.contrato_fecha_i}}</label></span>
                    <span>Fecha Fin: <label class="ng-binding">{{root.data.currentContract.contrato_fecha_f}}</label></span>
                    <span>Vendedor: <label class="ng-binding">{{root.data.currentContract.contrato_vendedor}}</label></span>
                    <span>Observaciones: <label class="ng-binding">{{root.data.currentContract.observaciones || 'Sin Observacion.'}}</label></span>
                    <span>Estado: <label class="ng-binding">{{root.data.currentContract.check ? 'Activo':'Inactivo'}}</label></span>
                </div>
                <div class="col-sm-12" style="padding: 0px;">
                    <span class="col-sm-offset-10 col-sm-2 total-saldo" style="font-size: 14px; font-weight: bolder; margin-bottom: 15px;">
                        Contrato Valor:
                        <label style="font-size: 16px;" class="ng-binding">
                            {{root.data.currentContract.contrato_valor}}
                        </label>
                    </span>
                </div>
            </div>
            <div class="container-table">
                <h4 style="text-align: center; color: #1c59b5;">Productos & Medicamentos del contrato</h4>
                <div class="table-responsive contractProducts" style="margin-bottom: 15px;">
                    <div ng-show="root.data.currentContract.products.length" ng-grid="contractProducts" style="width: 100%;">

                    </div>
                    <h4 ng-show="!root.data.currentContract.products.length" style="text-align: center; margin: 0px; background: #eaeaea; padding: 10px; font-size: 20px;">
                        <i>Sin productos agregados!</i>
                    </h4>
                </div>
            </div>
        </div>
    </div><br>
    <div class="panel panel-primary">
        <div class="panel-heading" style="text-transform: uppercase; text-align: center; margin: 0px; font-weight: 700;">
            Agregar Productos Al Contrato
        </div>
        <div class="panel-body">
            <div class="container-table">
                <div class="col-xs-12" style="margin: 0px auto 4px auto;"><br>
                    <div style="display: flex; justify-content: center; align-items: center;">
                        <div style="margin-right: 5px;">
                            Modo
                        </div>
                        <div class="switch2 ng-scope">
                            <input type="checkbox" ng-model="root.form.addProducts.mode" name="modeAddProduct" id="modeAddProduct" class="switch1-checkbox ng-pristine ng-untouched ng-valid">
                            <label class="switch1-label" for="modeAddProduct">
                                <span class="switch2-inner"></span>
                                <span class="switch2-switch" style="height: 88%;"></span>
                            </label>
                        </div>
                    </div><br>
                    <form class="col-sm-12" ng-submit="searchInventaryProducts()" ng-if="!root.form.addProducts.mode">
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-addon">Clase</div>
                                <input ng-model="root.form.addProducts.laboratorio" type="text" class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-number" style="padding: 5px;" id="exampleInputAmount" placeholder="Ingrese clase" min="1">
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-addon">SubClase</div>
                                <input ng-model="root.form.addProducts.principio_activo" type="text" class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-number" style="padding: 5px;" id="exampleInputAmount2" placeholder="Ingrese SubClase" min="1">
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-addon">Codigo producto</div>
                                <input ng-model="root.form.addProducts.codigo_producto" type="text" class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-number" style="padding: 5px;" id="exampleInputAmount3" placeholder="Ingrese codigo producto" min="1">
                            </div>
                        </div>
                        <div class="col-sm-3">
                            <div class="input-group">
                                <div class="input-group-addon">Descripcion</div>
                                <input ng-model="root.form.addProducts.descripcion" type="text" class="form-control ng-pristine ng-untouched ng-invalid ng-invalid-number" style="padding: 5px;" id="exampleInputAmount4" placeholder="Ingrese Descripcion" min="1">
                            </div>
                        </div>
                        <div class="col-xs-12"><br>
                            <button type="submit" class="btn btn-primary col-sm-offset-5 col-xs-2" style="padding: 5px;">
                                <span class="span-flex-center"><i class="glyphicon glyphicon-search" style="margin-right: 2px;"></i> Buscar</span>
                            </button>
                        </div>
                    </form>
                </div>
                <div class="col-xs-12" ng-if="root.form.addProducts.mode">
                    <!--
                        <div class="col-sm-offset-4 col-sm-4">
                            <label for="">Adjuntar Archivo</label>
                            <input type="file" class="btn btn-primary" style="display: inline-block;">
                        </div>
                    -->
                    <div flow-init="opciones_archivo"  flow-file-success="respuesta_archivo_plano($file, $message);" flow-file-added="!!{xls:1,xlsx:1}[$file.getExtension()]" flow-files-submitted="cargar_archivo_plano($flow)" class="ng-scope" flow-prevent-drop=""  flow-drag-enter="dropClass='drag-over'" flow-drag-leave="dropClass=''" >
                        <div class="drop txt-center" flow-drop="" ng-class="dropClass" >
                            <div class="col-md-12">
                                <img  ng-hide="$flow.files.length" src="../../../images/Cloud-Upload-Blue.png" style="max-width: 200px; max-height: 150px; line-height: 20px; margin-bottom: 5px;"/>
                                <img ng-show="$flow.files.length" src="../../../images/xls.png" style="max-width: 200px; max-height: 150px; line-height: 20px; margin-bottom: 5px;"/>
                            </div>
                            <div ng-hide="$flow.files.length">
                                Arrastrar y Soltar el archivo <b>AQUI</b>!!
                            </div>
                            <div class="" ng-repeat="file in $flow.files" ng-show="$flow.files.length">
                                Nombre Archivo : <label>{{file.name}}</label>
                                <div class="progress progress-striped" ng-class="{active: file.isUploading()}">
                                    <div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0"
                                         aria-valuemax="100" ng-style="{width: root.progresoArchivo + '%'}">
                                    </div>
                                    <span class="sr-only ng-binding">{{root.progresoArchivo}}% Completado</span>
                                </div>
                            </div>
                        </div><br>

                        <div class="well txt-center">
                            <span class="btn btn-default" flow-btn="" ng-hide="$flow.files.length" ng-disabled="validacion_buscar_productos() || Pedido.get_numero_pedido() > 0">
                                <span class="glyphicon glyphicon-folder-open" style="margin-right: 5px;"></span> Seleccionar Archivo
                                <input type="file" style="visibility: hidden; position: absolute;">
                            </span>
                            <button class="btn btn-default" ng-click="$flow.cancel()" ng-disabled="" ng-show="$flow.files.length">
                                <span class="glyphicon glyphicon-minus" ></span> Remover
                            </button>
                            <button class="btn btn-default" ng-click="subir_archivo_plano()" ng-disabled="validacion_buscar_productos()" ng-show="$flow.files.length">
                                <span class="glyphicon glyphicon-cloud-upload" ></span> Subir
                            </button>
                        </div>
                    </div>
                    <br><br>
                </div>
            </div>
        </div>
    </div>
    <div class="panel panel-primary">
        <div class="panel-heading" style="text-transform: uppercase; text-align: center; margin: 0px; font-weight: 700;">
            Validacion de Productos
        </div>
        <div class="panel-body"><br>
            <div class="container-table" ng-show="root.data.searchProducts.length" style="height: 234px; overflow-y: scroll;">
                <table class="table-responsive contractProducts">
                    <tbody>
                    <tr style="background: #337ab7; color: #FFF; font-weight: 600;">
                        <td width="12%">Codigo</td>
                        <td width="30%">Descripcion</td>
                        <td width="8%">Autorizacion</td>
                        <td width="12%">Costo ultima compra</td>
                        <td width="13%">Precio venta</td>
                        <td width="20%">Justificación</td>
                        <td width="5%">Agregar</td>
                    </tr>
                    <tr ng-repeat="producto in root.data.searchProducts track by $index">
                        <td>{{producto.codigo}}</td>
                        <td>{{producto.descripcion}}</td>
                        <td>{{producto.requiere_autorizacion}}</td>
                        <td>{{producto.costo_ultima_compraString}}</td>
                        <td>
                            <div style="text-align: center; display: flex; justify-content: center;">
                                <input ng-if="producto.withOutDocument" ng-model="producto.precio_venta" class="form-control" style="width: 90%; height: 30px;" type="number" placeholder="Inserte precio venta" required>
                                <label ng-if="!producto.withOutDocument" style="width: 90%; height: 30px; display: flex; align-items: center; justify-content: center;">
                                    {{producto.precio_ventaString}}
                                </label>
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center; display: flex; justify-content: center;">
                                <input ng-disabled="producto.precio_venta > producto.costo_ultima_compra" ng-model="producto.justificacion" minlength="20" class="form-control" style="width: 90%; height: 30px;" type="text" placeholder="Justificación del precio de venta" title="Justifique cuando precio venta sea menor al costo">
                            </div>
                        </td>
                        <td>
                            <div style="text-align: center;">
                                <input ng-click="test()" ng-model="producto.check" type="checkbox" id={{producto.codigo}} class="checkbox3">
                                <label for={{producto.codigo}} class="label3">
                                    <i class="glyphicon glyphicon-check"></i>
                                </label>
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <span ng-show="root.data.searchProducts.length" ng-click="addProductsContract()" class="col-sm-offset-4 col-sm-4 col-lg-offset-5 col-lg-2 btn" style="background: #399039; color: #FFF; margin-bottom: 4px; margin-top: 20px;">
                <span style="display: flex; justify-content: center; align-content: center;">
                    <i class="glyphicon glyphicon-plus" style="margin-right: 3px; top: 3px;"></i>
                    Agregar Productos al Contrato
                </span>
            </span><br>
        </div>
    </div><br>
</div>
<div class="modal-footer">
    <button class="btn btn-primary" ng-click="cerrar()">Cerrar</button>
</div>
